<div class="container pt-5">

  <div class="row p-5 mt-5">
    <div class="col-md-4 order-md-2 mb-4 p-5 mt-5">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Your cart</span>
        {{!-- <span class="badge badge-secondary badge-pill">3</span> --}}
      </h4>
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">Product</h6>
            <small class="text-muted">total amount is</small><br>
            <small class=" text-success fw-bold" id="couponadded" style="display: none;">couponadded</small>
          </div>
          <span class="text-muted">{{totalAmount}}</span>
        </li>
        {{!-- <p class="text-danger" id="couponadded">coupon activated</p> --}}
        <li class="list-group-item d-flex justify-content-between lh-condensed">
         
          <div>
            {{!-- <h6 class="my-0">Second product</h6>
            <small class="text-muted">Brief description</small>
          </div>
          <span class="text-muted">$8</span>
        </li>
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">Third item</h6>
            <small class="text-muted">Brief description</small>
          </div>
          <span class="text-muted">$5</span>
        </li> --}}
        {{!-- <li class="list-group-item d-flex justify-content-between bg-light">
          <div class="text-success">
            <h6 class="my-0">Promo code</h6>
            <small>EXAMPLECODE</small>
          </div>
          <span class="text-success">-$5</span>
        </li> --}}
        <li class="list-group-item d-flex justify-content-between" id="totalprice">
          <span >Total </span>
         
          
          <strong>{{totalAmount}}</strong>
       
        </li>
      </ul>

      {{!-- <form class="card p-2">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Promo code">
          <div class="input-group-append">
            <button type="submit" class="btn btn-secondary">Redeem</button>
          </div>
        </div>
      </form> --}}
    
    <div>
      {{!-- <button class="btn btn-warning">apply coupon</button> --}}

      <button type="button" id="applycoupon" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#couponModal">
 apply coupon
</button>

 <a href="/cancelcoupon"><button type="button" id="cancelcoupon" class="btn btn-warning" style="display:none;"  >
 cancel coupon
</button></a>
   
   
    </div>
   
{{!-- modal-coupon-starts --}}

<div class="modal fade" id="couponModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h5 class="modal-title ml-5" id="exampleModalLabel">Coupon Apply</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        
      </div>
      <div><p class="text-center text-danger fw-bold" id="errcoupon" style="display: none;">unvalid coupon code</p></div>
      
      <form action="/applyCoupon-offer" id="applyCoupon" method="post">
      
        {{!-- <p class="text-center text-success fw-bold" id="successcoupon">coun redeemed successfully</p> --}}
        
        
         <div class="modal-body">
        <label >enter the coupon code :</label>
        <input type="text" for="coupon" name="couponCode">
        
     
      </div>

     
     
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Apply</button>
      </div>
     </form>
    </div>
  </div>
</div>
   
{{!-- coupon modal ends --}}
    </div>


    <div class="col-md-8 order-md-1">
      <h4 class="mb-3">Billing address</h4>
      <form class="needs-validation" action="" id="checkout-form">
        <div class="row">
          
          <div class=" mb-3">
            <label for="firstName">Name</label>
            <input type="text" class="form-control" name="name" id="firstName" placeholder="" value="" required>
            <div class="invalid-feedback">
              name is required.
            </div>
          </div>
          {{!-- <div class="col-md-6 mb-3">
            <label for="lastName">Last name</label>
            <input type="text" class="form-control" id="lastName" placeholder="" value="" required>
            <div class="invalid-feedback">
              Valid last name is required.
            </div>
          </div> --}}
        </div>

        <div class="mb-3">
          <label for="username">phonenumber</label>
          <div class="input-group">

            <input type="text" class="form-control" id="username" name="phonenumber" placeholder="Phone number"
              required>
            <div class="invalid-feedback" style="width: 100%;">
              phnonenumber is required.
            </div>
          </div>
        </div>
    
        {{!-- totalamount --}}
        <input type="text" class="form-control" style="display: none;" id="actualCost" name="totalprice" value={{totalAmount}}>

        <div class="mb-3">
          <label for="email">Email <span class="text-muted">(Optional)</span></label>
          <input type="email" class="form-control" name="email" id="email" placeholder="email">
          <div class="invalid-feedback">
            Please enter a valid email address for shipping updates.
          </div>
        </div>

        <div class="mb-3">
          <label for="address">Address</label>
          <input type="text" class="form-control" name="address" id="address" placeholder="1234 Main St" required>
          <div class="invalid-feedback">
            Please enter your shipping address.
          </div>
        </div>

        <div class="mb-3">
          <label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
          <input type="text" class="form-control" name="optionaladdress" id="address2" placeholder="Apartment or suite">
        </div>

        <div class="col-md-6 mb-3">
          <label for="pincode">Pincode</label>
          <input type="text" class="form-control" name="pincode" id="pincode" placeholder="" value="" required>
          <div class="invalid-feedback">
            Valid last name is required.
          </div>
        </div>

        <hr class="mb-4">
        <div class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input" id="same-address">
          <label class="custom-control-label" for="same-address">Shipping address is the same as my billing
            address</label>
        </div>
        <div class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input" id="save-info">
          <label class="custom-control-label" for="save-info">Save this information for next time</label>
        </div>
        <input type="text" name="userId" id="" value="{{user._id}}" hidden>


        <hr class="mb-4">



        <h4 class="mb-3">Payment</h4>

        <div class="d-block my-3 ">

          <div class="custom-control custom-radio">
            <input id="credit" name="payment-method" value="COD" type="radio" class="custom-control-input" checked
              required>
            <label class="custom-control-label" for="cod">COD</label>
          </div>

          {{!-- <div class="custom-control custom-radio">
            <input id="credit" name="payment-method" value="paypal" type="radio" class="custom-control-input"
              checked required>
            <label class="custom-control-label" vfor="paypal">paypal</label>
          </div> --}}
          {{!-- <div class="custom-control custom-radio">
            <input id="debit" name="payment-method" value="debitcard" type="radio" class="custom-control-input"
              required>
            <label class="custom-control-label" for="debit">Debit card</label>
          </div> --}}
          <div class="custom-control custom-radio">
            <input id="paypal" name="payment-method" value="paypal" type="radio" class="custom-control-input" required>
            <label class="custom-control-label" for="paypal">PayPal</label>
          </div>
        </div>




        <hr class="mb-4">
      
      
        <button class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>
      </form>
    </div>



  </div>


</div>


<script>

  $('#checkout-form').submit((e) => {
    e.preventDefault()
    $.ajax({
      url: '/checkcart',
      method: "post",
      data: $('#checkout-form').serialize(),
      success: (response) => {
      
      if(response.COD){

     swal({
          title: "Sucess",
          text: "sucessfully placed order",
          icon: "success",
          button: "ok",
        })
          .then((willSuccess) => {
            if (willSuccess) {
              location.href = "/userhome";
            }
          })


      }else{
        location.href=response.url
      }
      
        
      }
    })
  })

$('#applyCoupon').submit((e)=>{
  e.preventDefault()
  $.ajax({
    url:'/applyCoupon-offer',
    method:'post',
    data:$('#applyCoupon').serialize(),
    success:(totalamount)=>{
     
     if(totalamount>0){
        
        console.log(totalamount,'successs')
   //document.getElementById('totalpricespan').innerHTML='total'
    let totalprice=document.getElementById('totalprice')
      //totalprice.innerHTML="total:"
     document.getElementById('actualCost').value=totalamount
      totalprice.innerHTML=totalamount
      totalprice.style.color='red';
     totalprice.style.fontSize = "x-large";
     totalprice.style.fontWeight = "900";
     document.getElementById('couponadded').style.display=''  
     document.getElementById('applycoupon').style.display='none'
     document.getElementById('cancelcoupon').style.display=''
     }else{

    console.log(totalamount,'false')
     document.getElementById('errcoupon').style.display=''
    
     setTimeout(() => {
  window.location.reload();
          }, 500);

     
     }

    }
  })
})



</script>